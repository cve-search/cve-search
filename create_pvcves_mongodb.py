import pymongo

mongo_client = pymongo.MongoClient("mongodb://localhost:27017/")
mongo_db = mongo_client["cvedb"]
mongo_collection = mongo_db["cves"]

mongo_db['p_v_cves'].drop()

a = []

cves = mongo_collection.find({})
i = 0

for cve in cves:
    for product in cve['vulnerable_product']:
        product_name = product.split(":")[4]
        product_version = product.split(":")[5]
        if i % 10000 == 0:
            if len(a) > 0:
                esito = mongo_db['p_v_cves'].bulk_write(a)
                print("{} {}".format(str(len(a)), esito))
            a = []
        a.append(
            pymongo.InsertOne({
                'product_name': product_name,
                'product_version': product_version,
                'cve_id': cve['id']
            })
        )
        i = i + 1
