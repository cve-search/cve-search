language: python

python:
    - "3.6"
    - "nightly"

cache: pip

services:
    - redis-server
    - mongodb

stages:
  - build
  - test

jobs:
    include:
        - stage: build
            install:
                - pip install -q -U pip
                - pip install -q -r requirements.txt
                - pushd sbin
                - ./db_mgmt_json.py -p
                - ./db_mgmt_cpe_dictionary.py -p
                - popd

        - stage: test
            script:
                - pytest --cov-report term --cov=./ test/ -v
            after_success:
                - codecov

notifications:
    email:
        on_success: change
        on_failure: change
