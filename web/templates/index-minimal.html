{% extends 'layouts/master-page' %}
{% block title %}Most recent entries{% endblock %}
{% block head %}
  <!-- css -->
  <link href="/static/css/custom/filter.css" rel="stylesheet" />

  <!-- javascript -->
  <script type="text/javascript" src="/static/js/custom/filter.js"></script>
  <script type="text/javascript">
    function setSettings(){
      {% if settings is defined%}
        document.getElementById('timeSelect').value = "{{settings['timeSelect']}}";
        document.getElementById('startDate').value = "{{settings['startDate']}}";
        document.getElementById('endDate').value = "{{settings['endDate']}}";
        document.getElementById('timeTypeSelect').value = "{{settings['timeTypeSelect']}}";
        document.getElementById('cvssSelect').value = "{{settings['cvssSelect']}}";
        document.getElementById('cvss').value = "{{settings['cvss']}}";
        document.getElementById('rejectedSelect').value = "{{settings['rejectedSelect']}}";
        cvssSelectDisable()
        timeSelectDisable()
      {%endif%}
    }
    function postURL(url) {
      var form = document.getElementById("filter");
      form.action = url;
      form.submit();
    }
    function next(n){
      setSettings();
      var multiplier = {{ r }} + ( n * {{ pageLength }});
      var url = "/r/"+multiplier;
      postURL(url);
    }
    function previous(n){
      setSettings();
      var page = {{ r }} - ( n * {{ pageLength }});
      if(page < 0){
        page = 0;}
      var url = "/r/" + page;
      postURL(url);
    }
  </script>
{% endblock %}
{% block content %}
  <!-- Filter options -->
  <button type="button" class="btn btn-primary btn-xs" data-toggle="collapse" data-target="#filterdiv">
    Hide/Show filter
  </button>
  <div id="filterdiv" class="collapse well well-small">  
    <form method="POST" id="filter" class="nav form-search" onsubmit="/filter">
      <table class="searchTable">
        <tr>
          <td class="text">Time</td>
          <td colspan="5">
            <select onChange="timeSelectDisable()" name="timeSelect" id="timeSelect">
              <option value="all">All</option>
              <option value="from">From</option>
              <option value="until">Until</option>
              <option value="between">Between</option>
              <option value="outside">Not During</option>
            </select>
            <input type="date" placeholder="Start date" name="startDate" id="startDate" readOnly Title="Date in dd/mm/yyyy or dd/mm/yy format, using / or -" pattern="^(?:(?:31(-|\/)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(-|\/)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(-|\/)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(-|\/)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$"></input>
            <input type="date" placeholder="End date" name="endDate" id="endDate" readOnly Title="Date in dd/mm/yyyy or dd/mm/yy format, using / or -" pattern="^(?:(?:31(-|\/)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(-|\/)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(-|\/)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(-|\/)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$"></input>
            <select name="timeTypeSelect" id="timeTypeSelect" readOnly>
              <option value="Modified">Last Major Update</option>
              <option value="Published">Published</option>
              <option value="last-modified">Last Update</option>
            </select>
          </td>
        </tr>
        <tr>
          <td class="text">CVSS</td>
          <td>
            <select name="cvssSelect" id="cvssSelect" onChange="cvssSelectDisable()">
              <option value="all">All</option>
              <option value="above">Above</option>
              <option value="equals">Equals</option>
              <option value="below">Below</option>
            </select>
            <input name="cvss" id="cvss" type="number" readOnly min="0" max="10" step="0.5" value="0"></input>
          </td>
          <td>Rejected</td>
          <td>
            <select name="rejectedSelect" id="rejectedSelect">
              <option value="hide">Hide</option>
              <option value="show">Show</option>
            </select>
          </td>
        </tr>
        <tr>
          <td colspan="4"><input type="submit" value="Search"/></td>
        </tr>
      </table>
    </form>
  </div>
  <!-- Pager -->
  {% include 'subpages/ager.html' %}
  <!-- Search results -->
  {% include 'subpages/table.html' %}
  <!-- Pager -->
  {% include 'subpages/pager.html' %}
  <!-- end content -->
{% endblock %}
