{% extends 'layouts/master-page' %}
{% block title %}Admin page{% endblock %}
{% block head %}
  <!-- css -->
  <link href="/static/css/custom/admin.css" rel="stylesheet" />

  <!-- javascript -->
  <script type="text/javascript" src="/static/js/custom/admin.js"></script>
  <script>
    {% if status %}
      data = {status: "{{status}}"}
      parseStatus(data);
    {% endif %}
  </script>
{% endblock %}
{% block content %}
  <div id='stats' class="well well-small">
    <span>Database info for database <b>{{stats['dbName']}}</b></span>
    <table class="table table-hover table-striped table-nonfluid table-condensed">
      <thead>
        <tr class="warning"><td>Collection</td><td>#records</td><td>Last update</td></tr>
      </thead>
      <tbody>
        <tr><td>CVES</td>             <td>{{stats['cveA']}}</td>
            <td>{% if stats['cveU'] is not none %}{{stats['cveU'].strftime('%d-%m-%Y - %H:%M')}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>CPE</td>              <td>{{stats['cpeA']}}</td>
            <td>{% if stats['cpeU'] is not none %}{{stats['cpeU'].strftime('%d-%m-%Y - %H:%M')}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>CPE-other</td>        <td>{{stats['cpeOtherA']}}</td>
            <td>{% if stats['cpeOtherU'] is not none %}{{stats['cpeOtherU'].strftime('%d-%m-%Y - %H:%M')}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>Capec</td>            <td>{{stats['capecA']}}</td>
            <td>{% if stats['capecU'] is not none %}{{stats['capecU'].strftime('%d-%m-%Y - %H:%M')}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>d2sec</td>            <td>{{stats['d2secA']}}</td>
            <td>{% if stats['d2secU'] is not none %}{{stats['d2secU'].strftime('%d-%m-%Y - %H:%M')}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>Vendor statements</td><td>{{stats['vendorA']}}</td>
            <td>{% if stats['vendorU'] is not none %}{{stats['vendorU'].strftime('%d-%m-%Y - %H:%M')}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>vFeed info</td>       <td>{{stats['vfeedA']}}</td>
            <td>{% if stats['vfeedU'] is not none %}{{stats['vfeedU'].strftime('%d-%m-%Y - %H:%M')}} {% else %}Not updated{% endif %}</td><tr>
      </tbody>
    </table>
    <span id="wl_rules">Whitelist: {{stats['wlA']}} rules</span><br />
    <span id="bl_rules">Blacklist: {{stats['blA']}} rules</span><br /><br />
    <span>Database size: {{'%0.2f' % (stats['dbSize']/1024**2)}}MB ({{'%0.2f' % (stats['dbSize']/1024**3)}}GB)</span><br />
    <span>Database size on disk: {{'%0.2f' % (stats['dbOnDisk']/1024**2)}}MB ({{'%0.2f' % (stats['dbOnDisk']/1024**3)}}GB)</span>
  </div>
  <!-- Plug-in information -->
  <div id="plugins" class="well well-small">
    <strong>Plug-in Information</strong> <br />
    <table class="table table-hover table-striped table-nonfluid table-condensed">
      <thead>
        <tr class="warning"><td>Name</td><td>UID</td><td>Type</td><td>State</td></tr>
      </thead>
      <tbody>
        {% for plug in plugins|sort(attribute="name") %}
          {% set ptype = "Web" if plug.isWebPlugin() else "Backend" %}
          <tr><td>{{plug.name}}</td><td>{{plug.uid}}</td><td>{{ptype}}</td><td>{{plug.loadstate}}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <!-- Database update -->
  <div class="well well-small tab">
    <strong>Update the database</strong> <br />
    <button onclick="updateDB()">Update</button>
  </div>
  <!-- Whitelist import -->
  <div class="well well-small tab">
    <strong>Manage whitelist</strong> <br />
    <input id="wl_Import" type='file' name='file' /> <br />
    <input type="checkbox" id="wl_ForceImport">Force<br />
    <button onclick="whitelistImport()">Import</button>
    <button onclick="whitelistExport()">Export</button>
    <button onclick="dropWhitelist()">Drop list</button>
    <button onclick="location.href='/admin/whitelist'">View</button>
  </div>
  <!-- Blacklist import -->
  <div class="well well-small tab">
    <strong>Manage blacklist</strong> <br />
    <input id="bl_Import" type='file' name='file' /> <br />
    <input type="checkbox" id="bl_ForceImport">Force<br />
    <button onclick="blacklistImport()">Import</button>
    <button onclick="blacklistExport()">Export</button>
    <button onclick="dropBlacklist()">Drop list</button>
    <button onclick="location.href='/admin/blacklist'">View</button>
  </div>
  <!-- Change password -->
  <div class="well well-small tab">
    <strong>Change your password</strong> <br />
    <table>
      <tr><td>Current</td><td><input type="password" name="current_pass" id="current_pass"></td></tr>
      <tr><td>New    </td><td><input type="password" name="new_pass"     id="new_pass">    </td></tr>
      <tr><td>Repeat </td><td><input type="password" name="repeat_pass"  id="repeat_pass"> </td></tr>
    </table>
    <button onclick="changePass()">Update</button>
  </div>
  <a href="#" class="back-to-top">Back to Top</a>
{% endblock %}
