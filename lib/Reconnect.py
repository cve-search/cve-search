from functools import wraps
import time
from pymongo.errors import AutoReconnect


def reconnect(func):
    maxRetries = 3

    @wraps(func)
    def wrapper(*args, **kwargs):
        fails = 0

        while True:
            try:
                return func(*args, **kwargs)
            except AutoReconnect as e:
                fails += 1
                print("Retry: " + str(fails))

                time.sleep(2 ** fails)
                if fails >= maxRetries:
                    raise e

    return wrapper
