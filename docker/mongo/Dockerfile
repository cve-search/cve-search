FROM mongo:4.4

# Set an environment variable with the directory
# where we'll be running the app
ENV APP /install

# Create the directory and instruct Docker to operate
# from there from now on
RUN mkdir $APP
WORKDIR $APP

RUN apt-get update && \
    apt-get install --no-install-recommends -y p7zip-full=16.02+dfsg-7build1 && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

COPY ./src/install.sh /docker-entrypoint-initdb.d/install.sh

RUN sed -i -e 's/\r$//' /docker-entrypoint-initdb.d/install.sh && \
    chmod +x /docker-entrypoint-initdb.d/install.sh

COPY ./src/db_dump_part* ./

RUN ["chown", "mongodb:", "-R", "/install"]

EXPOSE 27017
