#!/usr/bin/env bash

set -x
set -e

# Pwnie docker repo in Azure
export DOCKER_REPO="bucephalux.azurecr.io"

# define variables for release labels in compose file

export BRANCH=$(git rev-parse --abbrev-ref HEAD)
export BUILD_HOST=$(hostname -f)
# or git log -1 --pretty=%h
export COMMIT=$(git show --format=format:%h -s HEAD)
export CURRENT_DATE=$(date +%Y-%m-%d:%Hh%Mm%Ss)


# build images
docker-compose -f docker-push.yml build

# push images
docker-compose -f docker-push.yml push --ignore-push-failures
